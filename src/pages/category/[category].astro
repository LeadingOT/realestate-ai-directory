---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ListingCard from '../../components/ListingCard.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const listings = await getCollection('listings');
  const categories = [...new Set(listings.map((l) => l.data.category))];
  return categories.map((cat) => ({
    params: { category: cat.toLowerCase().replace(/\s+/g, '-') },
    props: {
      category: cat,
      listings: listings.filter((l) => l.data.category === cat),
    },
  }));
}

const { category, listings } = Astro.props;
---

<BaseLayout
  title={`Best ${category} Tools - Compare & Review`}
  description={`Find and compare the best ${category} tools. Features, pricing, and honest reviews.`}
>
  <h1 class="text-3xl font-bold mb-2">Best {category} Tools</h1>
  <p class="text-gray-600 mb-8">Compare {listings.length} tools in this category.</p>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {listings.map((listing: any) => (
      <ListingCard {...listing.data} />
    ))}
  </div>
</BaseLayout>
